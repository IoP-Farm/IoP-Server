# Ферма: Спецификация MQTT-топиков
**Версия:** 1.0  
**Дата:** 19.04.2025

## 1. Данные от фермы (farm001/data)
**Формат:** JSON

Пример:
```json
{
  "temperature_DHT22": 25.3,      // Температура воздуха от DHT22 (°C)
  "temperature_DS18B20": 24.8,    // Температура воды/воздуха от DS18B20 (°C)
  "humidity": 60,                 // Влажность воздуха от DHT22 (%)
  "water_level": 15,              // Уровень воды от HC-SR04 (%)
  "soil_moisture": 45,            // Влажность почвы от FC-28 (%)
  "light_intensity": 80           // Освещенность от KY-018 (%)
}
```

## 2. Конфигурация от сервера (farm001/config)
**Формат:** JSON

Пример:
```json
{
  "pump_interval_days": 2,        // Период полива (дни, целое число)
  "pump_start": "08:00",          // Время начала полива (HH:MM)
  "pump_volume_ml": 350,          // Объем воды за цикл (мл)
  
  "heatlamp_target_temp": 28,     // Целевая температура нагрева (°C)
  
  "growlight_on": "07:00",        // Время включения фитолампы (HH:MM)
  "growlight_off": "21:00"        // Время выключения фитолампы (HH:MM)
}
```

## 3. Команды от сервера (farm001/command)
**Формат:** JSON

Пример команды: 
```json
{"command": 3}
```

Список команд:
- **ID 0: ESP_RESTART**   - Аварийный перезапуск ESP32
- **ID 1: PUMP_ON**       - Включить насос
- **ID 2: PUMP_OFF**      - Выключить насос
- **ID 3: GROWLIGHT_ON**  - Включить фитолампу
- **ID 4: GROWLIGHT_OFF** - Выключить фитолампу
- **ID 5: HEATLAMP_ON**   - Включить лампу нагрева
- **ID 6: HEATLAMP_OFF**  - Выключить лампу нагрева

## Примечания
1. Все временные значения указываются в 24-часовом формате (HH:MM)
2. Процентные значения (water_level, soil_moisture, light_intensity) должны быть в диапазоне 0-100%
3. Для heatlamp_target_temp гистерезис (±ε) реализуется на стороне фермы
4. ID команд могут быть расширены в будущем
5. Обратите внимание, что это рабочий окончательный вариант, включающий все устройства, что у нас есть, и включающий их полный функционал на данный момент (базовый необходимый). Можно расширяться и добавлять еще функционал, но пока делаем так

## Примеры использования
1. Включить фитолампу:
   ```json
   {"command": 3}
   ```

2. Настройка полива (350 мл каждые 2 дня в 08:00):
   ```json
   {
     "pump_interval_days": 2,
     "pump_start": "08:00",
     "pump_volume_ml": 350
   }
   ```

3. Аварийный перезапуск:
   ```json
   {"command": 0}
   ``` 